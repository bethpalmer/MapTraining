<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Maps Training</title>
	<style>
		html,
		body {
			font-family: Arial, sans-serif;
			height: 100%;
			margin: 0;
			padding: 0;
		}
		#map {
			bottom: 0px;
			height: 100vh;
			left: 362px;
			position: absolute;
			right: 0px;

		}

		.options-box {
			background: #fff;
			border: 1px solid #999;
			border-radius: 3px;
			height: 100vh;
			line-height: 35px;
			padding: 10px 10px 30px 10px;
			text-align: left;
			width: 340px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="options-box">
			<h1>Places I have lived</h1>
			<div>
				<input id="show-houses" type="button" value="Show Houses">
				<input id="hide-houses" type="button" value="Hide Houses">
			</div>
		</div>
		<div id="map"></div>
	</div>

	<script>
		
		var markers = [];
		var map;

		function initMap(){
			// Create stykes array to use with map
			var styles = [
				{
					featureType: 'water',
					stylers: [
						{ color: '#19a0d8' }
					]
				},{
					featureType: 'administrative',
					elementType: 'labels.text.stroke',
					stylers: [
						{ color: '#ffffff' },
						{ weight: 6 }
					]
				},{
					featureType: 'administrative',
					elementType: 'labels.text.fill',
					stylers: [
						{ color: '#e85113' }
					]
				},{
					featureType: 'road.highway',
					elementType: 'geometry.stroke',
					stylers: [
						{ color: '#efe9e4' },
						{ lightness: -40 }
					]
				},{
					featureType: 'transit.station',
					stylers: [
						{ weight: 9 },
						{ hue: '#e85113'}
					]
				},{
					featureType: 'road.highway',
					elementType: 'labels.icons',
					stylers: [
						{ visibility: 'off' }
					]
				}
			]
			// Constructor creates a new map, only need lat/lng and zoom
			map = new google.maps.Map(document.getElementById('map'), {
				center: {lat: 50.827022, lng: -0.158278},
				zoom: 12,
				styles: styles,
				// turned off control as I have styled it a specicif way for a reason
				mapTypeControl: false
			});

			var largeInfowindow = new google.maps.InfoWindow();

			// style the markers a bit
			var defaultIcon = makeMarkerIcon('0091ff');

			// create highlighted marker icon on hover over
			var highlightedIcon = makeMarkerIcon('FFFF24');

			// var bounds = new google.maps.LatLngBounds();

			var locations = [
				{title: 'Sherbourne Road', location: {lat: 50.8514787, lng: -0.2010216}},
				{title: 'Adur Drive', location: {lat: 50.8360303, lng: -0.265268}},
				{title: 'Wilbury Road', location: {lat: 50.8325629, lng: -0.1669776}},
				{title: 'New Road', location: {lat: 50.874511, lng: 0.0061245}},
				{title: 'Coronation Street', location: {lat: 50.8332678, lng: -0.1265189}},
				{title: 'Cambridge Road', location: {lat: 50.826212, lng: -0.1593031}},
				{title: 'Middle Street', location: {lat: 50.8215338, lng: -0.1453002}},
				{title: 'Tivoli Cresc', location: {lat: 50.8427806, lng: -0.1600604}}
			];

			for (var i=0; i < locations.length; i++){
				var postion = locations[i].location;
				var title = locations[i].title;
				var marker = new google.maps.Marker({
					// map: map, // We now set this in the showHouses()
					position: postion,
					title: title,
					icon: defaultIcon,
					animation: google.maps.Animation.DROP,
					id: i
				});
				// push the marker to our array of markers
				markers.push(marker);
				// extend the bounds of what is displayed on the map
				// bounds.extend(marker.position); // moved to the showHouses()
				// create an onclick event to open an info window at each marker
				marker.addListener('click', function(){
					populateInfoWindow(this, largeInfowindow);
				});
				// Two event listeners - mouseover and mouseout to change colours
				marker.addListener('mouseover', function(){
					this.setIcon(highlightedIcon);
				});
				marker.addListener('mouseout', function(){
					this.setIcon(defaultIcon);
				});
			}
			// map.fitBounds(bounds); // won't set map bounds until we showHouses()

			document.getElementById('show-houses').addEventListener('click', showHouses);
			document.getElementById('hide-houses').addEventListener('click', hideHouses);
		}

		// This function populates the infowindow when the marker is clicked. Only allows one info window to open, and populates based on markers position.
		function populateInfoWindow(marker, infowindow){
			// check to make sure infowindow is not already open
			if (infowindow.marker != marker) {
				infowindow.marker = marker;
				infowindow.setContent('<div>' + marker.title + '</div>');
				infowindow.open(map, marker);
				// make sure the marker property is cleared if the infowindow is closed
				Infowindow.addListener('closeclick', function(){
					infowindow.setMarker(null);
				})
			}
		}

		// This function will loop through the markers array and display them all
		function showHouses(){
			var bounds = new google.maps.LatLngBounds();
			// Extend the boundaries of the mapfor each marker and display the marker
			for (var i=0; i<markers.length; i++){
				markers[i].setMap(map);
				bounds.extend(markers[i].position);
			}
			map.fitBounds(bounds);
		}

		function hideHouses(){
			for (var i=0; i<markers.length; i++){
				markers[i].setMap(null);
			}
		}

		// This function takes in a colour, and then creates a new marker icon of that colour. The icon will be 21px wide, 34px high, have an origin of 0, 0 and be anchored at 10, 34.
		function makeMarkerIcon(markerColor){
			var markerImage = new google.maps.MarkerImage(
				'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+ markerColor +'|40|_|%E2%80%A2',
				new google.maps.Size(21, 34),
				new google.maps.Point(0, 0),
				new google.maps.Point(10, 34),
				new google.maps.Size(21, 34));
			return markerImage;
		}
	</script>

	<script async defer
     src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAoEnMQe4ZX1tFEinO8c3XUHt7AHO0ipEM&callback=initMap">
    </script>
</body>
</html>